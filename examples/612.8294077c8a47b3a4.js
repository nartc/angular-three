"use strict";(self.webpackChunksandbox=self.webpackChunksandbox||[]).push([[612],{7152:(de,J,f)=>{f.d(J,{Z:()=>A});var i=f(9955),P=f(3619);const U={schedule(w){let m=requestAnimationFrame,B=cancelAnimationFrame;const{delegate:R}=U;R&&(m=R.requestAnimationFrame,B=R.cancelAnimationFrame);const j=m(q=>{B=void 0,w(q)});return new P.w0(()=>B?.(j))},requestAnimationFrame(...w){const{delegate:m}=U;return(m?.requestAnimationFrame||requestAnimationFrame)(...w)},cancelAnimationFrame(...w){const{delegate:m}=U;return(m?.cancelAnimationFrame||cancelAnimationFrame)(...w)},delegate:void 0};var O=f(5324);const A=new class o extends O.v{flush(m){this._active=!0;const B=this._scheduled;this._scheduled=void 0;const{actions:R}=this;let j;m=m||R.shift();do{if(j=m.execute(m.state,m.delay))break}while((m=R[0])&&m.id===B&&R.shift());if(this._active=!1,j){for(;(m=R[0])&&m.id===B&&R.shift();)m.unsubscribe();throw j}}}(class Z extends i.o{constructor(m,B){super(m,B),this.scheduler=m,this.work=B}requestAsyncId(m,B,R=0){return null!==R&&R>0?super.requestAsyncId(m,B,R):(m.actions.push(this),m._scheduled||(m._scheduled=U.requestAnimationFrame(()=>m.flush(void 0))))}recycleAsyncId(m,B,R=0){if(null!=R&&R>0||null==R&&this.delay>0)return super.recycleAsyncId(m,B,R);m.actions.some(j=>j.id===B)||(U.cancelAnimationFrame(B),m._scheduled=void 0)}})},7451:(de,J,f)=>{f.d(J,{eR:()=>j,pB:()=>A});var i=f(8368),P=f(9709),U=f(969);const Z=["*"];let A=(()=>{class b extends i.fc{set left(g){this.set({left:(0,i.su)(g)})}set right(g){this.set({right:(0,i.su)(g)})}set top(g){this.set({top:(0,i.su)(g)})}set bottom(g){this.set({bottom:(0,i.su)(g)})}set near(g){this.set({near:(0,i.su)(g)})}set far(g){this.set({far:(0,i.su)(g)})}get cameraType(){return U.iKG}get optionFields(){return{...super.optionFields,left:!0,right:!0,top:!0,bottom:!0,near:!0,far:!0}}}return b.\u0275fac=function(){let v;return function(F){return(v||(v=P.n5z(b)))(F||b)}}(),b.\u0275cmp=P.Xpm({type:b,selectors:[["ngt-orthographic-camera"]],inputs:{left:"left",right:"right",top:"top",bottom:"bottom",near:"near",far:"far"},standalone:!0,features:[P._Bn([(0,i.hS)(b),(0,i.dF)(b)]),P.qOj,P.jDz],ngContentSelectors:Z,decls:1,vars:0,template:function(g,F){1&g&&(P.F$t(),P.Hsn(0))},encapsulation:2,changeDetection:0}),b})(),j=(()=>{class b extends i.Jy{set args(g){this.set({instanceArgs:g})}set near(g){this.set({near:(0,i.su)(g)})}set far(g){this.set({far:(0,i.su)(g)})}set renderTarget(g){this.set({renderTarget:g})}objectInitFn(){const g=this.get(F=>F.instanceArgs);return new U._am(...g)}get preObjectInit(){return g=>{const F=this.get(ne=>ne.instanceArgs);F&&F.length&&this.set({near:F[0],far:F[1],renderTarget:F[2]}),this.effect((0,i.oe)(()=>{g()}))(this.instanceArgs$)}}get optionFields(){return{...super.optionFields,near:!1,far:!1,renderTarget:!1}}}return b.\u0275fac=function(){let v;return function(F){return(v||(v=P.n5z(b)))(F||b)}}(),b.\u0275cmp=P.Xpm({type:b,selectors:[["ngt-cube-camera"]],inputs:{args:"args",near:"near",far:"far",renderTarget:"renderTarget"},standalone:!0,features:[P._Bn([(0,i.RD)(b),(0,i.wY)(b)]),P.qOj,P.jDz],ngContentSelectors:Z,decls:1,vars:0,template:function(g,F){1&g&&(P.F$t(),P.Hsn(0))},encapsulation:2,changeDetection:0}),b})()},9612:(de,J,f)=>{f.d(J,{$5:()=>ye,fH:()=>pt,f4:()=>ft,sz:()=>Se});var i=f(8368),P=f(8786),U=f(2877),Z=f(3749),O=f(5688),o=f(9709),A=f(6706);function X(n){return(0,A.h)((r,e)=>n<=e)}var w=f(8926),m=f(4590),B=f(777),R=f(3250),j=f(112),q=f(1609),b=f(4216),v=f(7152),g=f(5628),F=f(7584),ne=f(6526),Ce=f(6628),l=f(969);const Me={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},Ee={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "};class Re extends l.yxD{constructor(r){super(r),this.type=l.cLu}parse(r){const u=function(d,N){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(N||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(N||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(N||""));break;default:console.error("THREE.RGBELoader: Error: "+(N||""))}return-1},I=function(d,N,M){N=N||1024;let T=d.pos,C=-1,p=0,E="",S=String.fromCharCode.apply(null,new Uint16Array(d.subarray(T,T+128)));for(;0>(C=S.indexOf("\n"))&&p<N&&T<d.byteLength;)E+=S,p+=S.length,T+=128,S+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(T,T+128)));return-1<C&&(!1!==M&&(d.pos+=p+C+1),E+S.slice(0,C))},ge=function(d,N,M,_){const C=Math.pow(2,d[N+3]-128)/255;M[_+0]=d[N+0]*C,M[_+1]=d[N+1]*C,M[_+2]=d[N+2]*C,M[_+3]=1},Ne=function(d,N,M,_){const C=Math.pow(2,d[N+3]-128)/255;M[_+0]=l.A5E.toHalfFloat(Math.min(d[N+0]*C,65504)),M[_+1]=l.A5E.toHalfFloat(Math.min(d[N+1]*C,65504)),M[_+2]=l.A5E.toHalfFloat(Math.min(d[N+2]*C,65504)),M[_+3]=l.A5E.toHalfFloat(1)},$=new Uint8Array(r);$.pos=0;const Y=function(d){const M=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,_=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,T=/^\s*FORMAT=(\S+)\s*$/,C=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,p={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let E,S;if(d.pos>=d.byteLength||!(E=I(d)))return u(1,"no header found");if(!(S=E.match(/^#\?(\S+)/)))return u(3,"bad initial token");for(p.valid|=1,p.programtype=S[1],p.string+=E+"\n";E=I(d),!1!==E;)if(p.string+=E+"\n","#"!==E.charAt(0)){if((S=E.match(M))&&(p.gamma=parseFloat(S[1])),(S=E.match(_))&&(p.exposure=parseFloat(S[1])),(S=E.match(T))&&(p.valid|=2,p.format=S[1]),(S=E.match(C))&&(p.valid|=4,p.height=parseInt(S[1],10),p.width=parseInt(S[2],10)),2&p.valid&&4&p.valid)break}else p.comments+=E+"\n";return 2&p.valid?4&p.valid?p:u(3,"missing image size specifier"):u(3,"missing format specifier")}($);if(-1!==Y){const d=Y.width,N=Y.height,M=function(d,N,M){const _=N;if(_<8||_>32767||2!==d[0]||2!==d[1]||128&d[2])return new Uint8Array(d);if(_!==(d[2]<<8|d[3]))return u(3,"wrong scanline width");const T=new Uint8Array(4*N*M);if(!T.length)return u(4,"unable to allocate buffer space");let C=0,p=0;const E=4*_,S=new Uint8Array(4),k=new Uint8Array(E);let _e=M;for(;_e>0&&p<d.byteLength;){if(p+4>d.byteLength)return u(1);if(S[0]=d[p++],S[1]=d[p++],S[2]=d[p++],S[3]=d[p++],2!=S[0]||2!=S[1]||(S[2]<<8|S[3])!=_)return u(3,"bad rgbe scanline format");let H,K=0;for(;K<E&&p<d.byteLength;){H=d[p++];const Q=H>128;if(Q&&(H-=128),0===H||K+H>E)return u(3,"bad scanline data");if(Q){const W=d[p++];for(let xe=0;xe<H;xe++)k[K++]=W}else k.set(d.subarray(p,p+H),K),K+=H,p+=H}const vt=_;for(let Q=0;Q<vt;Q++){let W=0;T[C]=k[Q+W],W+=_,T[C+1]=k[Q+W],W+=_,T[C+2]=k[Q+W],W+=_,T[C+3]=k[Q+W],C+=4}_e--}return T}($.subarray($.pos),d,N);if(-1!==M){let _,T,C,p;switch(this.type){case l.VzW:p=M.length/4;const E=new Float32Array(4*p);for(let k=0;k<p;k++)ge(M,4*k,E,4*k);_=E,C=l.VzW;break;case l.cLu:p=M.length/4;const S=new Uint16Array(4*p);for(let k=0;k<p;k++)Ne(M,4*k,S,4*k);_=S,C=l.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:N,data:_,header:Y.string,gamma:Y.gamma,exposure:Y.exposure,format:T,type:C}}}return null}setDataType(r){return this.type=r,this}load(r,e,t,a){return super.load(r,function s(c,u){switch(c.type){case l.VzW:case l.cLu:c.encoding=l.rnI,c.minFilter=l.wem,c.magFilter=l.wem,c.generateMipmaps=!1,c.flipY=!0}e&&e(c,u)},t,a)}}var he=f(2269);class V extends l.Kj0{constructor(){super(new l.DvJ(1,1,1),V.material)}}(0,he.Z)(V,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new l.Pa4},up:{value:new l.Pa4(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}),(0,he.Z)(V,"material",new l.jyz({name:"SkyShader",fragmentShader:V.SkyShader.fragmentShader,vertexShader:V.SkyShader.vertexShader,uniforms:l.rDY.clone(V.SkyShader.uniforms),side:l._Li,depthWrite:!1}));var pe=f(7451),me=f(3545),oe=f(693),Fe=f(8999);const ee=["*"],re=function(n){return{group:n}},Be=function(n){return[1,n,1]},fe=function(n){return[n,0,0]},Pe=function(n,r,e,t,a){return[n,r,e,t,0,a]};function De(n,r){if(1&n&&(o.ynx(0),o.TgZ(1,"ngt-mesh",2),o.ALo(2,"radian"),o._UZ(3,"ngt-mesh-basic-material",3),o.qZA(),o._UZ(4,"ngt-orthographic-camera",4),o.BQk()),2&n){const e=r.ngIf,t=o.oxw();o.xp6(1),o.Q6J("geometry",e.planeGeometry)("scale",o.VKq(10,Be,-1))("rotation",o.VKq(12,fe,o.lcZ(2,8,-90))),o.xp6(2),o.Q6J("map",e.renderTarget.texture)("opacity",e.opacity)("depthWrite",e.depthWrite),o.xp6(1),o.Q6J("ref",t.shadowCameraRef)("args",o.qbA(14,Pe,-e.width/2,e.width/2,e.height/2,-e.height/2,e.far))}}const Ie=["map",""];function ke(n,r){1&n&&o.GkF(0)}const ae=function(n,r,e){return[n,r,e]};function Oe(n,r){if(1&n){const e=o.EpF();o.TgZ(0,"ngt-cube-camera",5),o.NdJ("beforeRender",function(){o.CHM(e);const a=o.oxw();return o.KtG(a.onBeforeRender())}),o.qZA()}if(2&n){const e=r.ngIf,t=o.oxw();o.Q6J("ref",t.cubeCamera)("args",o.kEZ(2,ae,t.near,t.far,e))}}function je(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment-cube",6),2&n){const e=o.oxw();o.Q6J("ngtSobaEnvironmentPassThrough",e)}}function Ae(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment-map",7),2&n){const e=o.oxw();o.Q6J("ngtSobaEnvironmentPassThrough",e)("map",e.map)}}const ze=function(){return[1,16]};function Ge(n,r){if(1&n&&(o.ynx(0),o._UZ(1,"ngt-soba-environment-map",1),o.TgZ(2,"ngt-mesh",2),o._UZ(3,"ngt-icosahedron-geometry",3)(4,"ngt-shader-material",4),o.ALo(5,"side"),o.qZA(),o.BQk()),2&n){const e=r.ngIf,t=o.oxw();o.xp6(1),o.Q6J("ngtSobaEnvironmentPassThrough",t)("map",e.texture),o.xp6(1),o.Q6J("scale",e.scale),o.xp6(1),o.Q6J("args",o.DdM(11,ze)),o.xp6(1),o.Q6J("ref",t.materialRef)("side",o.lcZ(5,9,"back"))("vertexShader",t.vertexShader)("fragmentShader",e.fragment)("uniforms",t.uniforms)}}function Ue(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment-ground",2),2&n){const e=o.oxw();o.Q6J("ngtSobaEnvironmentPassThrough",e)}}function Le(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment-map",5),2&n){const e=o.oxw(2);o.Q6J("ngtSobaEnvironmentPassThrough",e)("map",e.map)}}function He(n,r){1&n&&o.GkF(0)}function Qe(n,r){if(1&n&&o.YNc(0,He,1,0,"ng-container",8),2&n){const e=o.oxw(4);o.Q6J("ngTemplateOutlet",e.content.templateRef)}}function We(n,r){if(1&n&&(o.TgZ(0,"ngt-soba-environment-portal",2),o.YNc(1,Qe,1,1,"ng-template",7),o.qZA()),2&n){const e=o.oxw(3);o.Q6J("ngtSobaEnvironmentPassThrough",e)}}function Ve(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment-cube",2),2&n){const e=o.oxw(3);o.Q6J("ngtSobaEnvironmentPassThrough",e)}}function Ze(n,r){if(1&n&&(o.YNc(0,We,2,1,"ngt-soba-environment-portal",0),o.YNc(1,Ve,1,1,"ng-template",null,6,o.W1O)),2&n){const e=o.MAs(2),t=o.oxw(2);o.Q6J("ngIf",!!t.content)("ngIfElse",e)}}function qe(n,r){if(1&n&&(o.YNc(0,Le,1,2,"ngt-soba-environment-map",3),o.YNc(1,Ze,3,2,"ng-template",null,4,o.W1O)),2&n){const e=o.MAs(2),t=o.oxw();o.Q6J("ngIf",!!t.map)("ngIfElse",e)}}const Ye=function(n){return{sky:n}};function Je(n,r){if(1&n&&o.GkF(0,1),2&n){const e=o.oxw();o.Q6J("ngTemplateOutlet",e.content.templateRef)("ngTemplateOutletContext",o.VKq(2,Ye,e.instance))}}function Xe(n,r){if(1&n&&o.GkF(0,9),2&n){const e=o.oxw();o.Q6J("ngTemplateOutlet",e.content.templateRef)("ngTemplateOutletContext",o.VKq(2,re,e.innerGroup))}}function $e(n,r){if(1&n&&o._UZ(0,"ngt-soba-contact-shadows",10),2&n){const e=o.oxw();o.Q6J("scale",2*e.radius)("far",e.radius/2)("blur",e.contactShadow.blur)("opacity",e.contactShadow.opacity)("position",e.contactShadow.position)}}function Ke(n,r){if(1&n&&o._UZ(0,"ngt-soba-environment",11),2&n){const e=o.oxw();o.Q6J("preset",e.environment)}}const et=function(){return["shadow","bias"]};let at=(()=>{class n extends i.Kw{constructor(){super(...arguments),this.count=1,this.shadowViewModel$=this.select(this.select(e=>e.priority),this.select(e=>e.planeGeometry),this.select(e=>e.renderTarget),this.select(e=>e.opacity),this.select(e=>e.depthWrite),this.select(e=>e.scaledWidth),this.select(e=>e.scaledHeight),this.select(e=>e.far),(e,t,a,s,c,u,h,y)=>({priority:e,planeGeometry:t,renderTarget:a,opacity:s,depthWrite:c,width:u,height:h,far:y})),this.setShadows=this.effect((0,w.b)(()=>{const{resolution:e,scaledWidth:t,scaledHeight:a,color:s}=this.get(),c=this.store.get(G=>G.gl),u=new l.dd2(e,e);u.texture.encoding=c.outputEncoding;const h=new l.dd2(e,e);h.texture.generateMipmaps=u.texture.generateMipmaps=!1;const y=new l.BKK(t,a).rotateX(Math.PI/2),x=new l.Kj0(y),D=new l.lRF;D.depthTest=D.depthWrite=!1,D.onBeforeCompile=G=>{G.uniforms={...G.uniforms,ucolor:{value:new l.Ilk(s).convertSRGBToLinear()}},G.fragmentShader=G.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),G.fragmentShader=G.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor, ( 1.0 - fragCoordZ ) * 1.0 );")};const I=new l.jyz(Me),L=new l.jyz(Ee);L.depthTest=I.depthTest=!1,this.zone.run(()=>{this.set({renderTarget:u,planeGeometry:y,depthMaterial:D,blurPlane:x,horizontalBlurMaterial:I,verticalBlurMaterial:L,renderTargetBlur:h})})}))}set opacity(e){this.set({opacity:(0,i.su)(e)})}get opacity(){return this.get(e=>e.opacity)}set width(e){this.set({width:(0,i.su)(e)})}get width(){return this.get(e=>e.scaledWidth)}set height(e){this.set({height:(0,i.su)(e)})}get height(){return this.get(e=>e.scaledHeight)}set blur(e){this.set({blur:(0,i.su)(e)})}set far(e){this.set({far:(0,i.su)(e)})}get far(){return this.get(e=>e.far)}set smooth(e){this.set({smooth:(0,i.Ig)(e)})}set resolution(e){this.set({resolution:(0,i.su)(e)})}set frames(e){this.set({frames:(0,i.su)(e)})}set depthWrite(e){this.set({depthWrite:(0,i.Ig)(e)})}get depthWrite(){return this.get(e=>e.depthWrite)}get planeGeometry(){return this.get(e=>e.planeGeometry)}get renderTarget(){return this.get(e=>e.renderTarget)}get shadowCameraRef(){return this.get(e=>e.shadowCameraRef)}preInit(){super.preInit(),this.set(e=>({shadowCameraRef:new i.Rl,scale:i.is.equ(e.scale.toArray(),(0,i.Sy)(l.Pa4,1).toArray())?(0,i.Sy)(l.Pa4,10):e.scale,frames:e.frames??1/0,opacity:e.opacity??1,width:e.width??1,height:e.height??1,blur:e.blur??1,far:e.far??10,resolution:e.resolution??512,smooth:e.smooth??!0,color:i.is.equ(e.color.toArray(),(0,i.Sy)(l.Ilk).toArray())?(0,i.Sy)(l.Ilk,"#000000"):e.color,depthWrite:e.depthWrite??!1}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.store.onReady(()=>{this.set(this.select(this.select(e=>e.width),this.select(e=>e.height),this.select(e=>e.scale),(e,t,a)=>({scaledWidth:e*a.x,scaledHeight:t*a.y}))),this.setShadows(this.select(this.select(e=>e.resolution),this.select(e=>e.scaledWidth),this.select(e=>e.scaledHeight),this.select(e=>e.scale),this.select(e=>e.color)))})})}onBeforeRender(e){e.scale.setScalar(1);const{shadowCameraRef:t,frames:a,depthMaterial:s,renderTarget:c,smooth:u,blur:h}=this.get(),y=this.store.get(D=>D.gl),x=this.store.get(D=>D.scene);if(t.value&&c&&(a===1/0||this.count<a)){const D=x.background;x.background=null;const I=x.overrideMaterial;x.overrideMaterial=s,y.setRenderTarget(c),y.render(x,t.value),x.overrideMaterial=I,this.blurShadows(h),u&&this.blurShadows(.4*h),y.setRenderTarget(null),x.background=D,this.count++}}blurShadows(e){const{renderTarget:t,blurPlane:a,horizontalBlurMaterial:s,verticalBlurMaterial:c,renderTargetBlur:u,shadowCameraRef:h}=this.get(),y=this.store.get(x=>x.gl);a.visible=!0,a.material=s,s.uniforms.tDiffuse.value=t.texture,s.uniforms.h.value=e/256,y.setRenderTarget(u),y.render(a,h.value),a.material=c,c.uniforms.tDiffuse.value=u.texture,c.uniforms.v.value=e/256,y.setRenderTarget(t),y.render(a,h.value),a.visible=!1}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-contact-shadows"]],inputs:{opacity:"opacity",width:"width",height:"height",blur:"blur",far:"far",smooth:"smooth",resolution:"resolution",frames:"frames",depthWrite:"depthWrite"},standalone:!0,features:[o._Bn([(0,i.RD)(n),(0,i.wY)(n),(0,i.Hm)(n)]),o.qOj,o.jDz],decls:4,vars:9,consts:[["name","soba-contact-shadows",3,"ngtObjectPassThrough","rotation","beforeRender"],[4,"ngIf"],[3,"geometry","scale","rotation"],["transparent","",3,"map","opacity","depthWrite"],[3,"ref","args"]],template:function(e,t){1&e&&(o.TgZ(0,"ngt-group",0),o.NdJ("beforeRender",function(s){return t.onBeforeRender(s.object)}),o.ALo(1,"radian"),o.YNc(2,De,5,20,"ng-container",1),o.ALo(3,"async"),o.qZA()),2&e&&(o.Q6J("ngtObjectPassThrough",t)("rotation",o.VKq(7,fe,o.lcZ(1,3,90))),o.xp6(2),o.Q6J("ngIf",o.lcZ(3,5,t.shadowViewModel$)))},dependencies:[U.U,i.VL,i.j4,O.O5,O.Ov,Z.oX,me.$t,pe.pB],encapsulation:2,changeDetection:0}),n})();const ie={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},ut=n=>!!n&&n.isCubeTexture;function se(n){return i.is.ref(n)?n.value:n}let z=(()=>{class n extends i.WZ{get frames(){return this.get(e=>e.frames)}set frames(e){this.set({frames:(0,i.su)(e)})}get near(){return this.get(e=>e.near)}set near(e){this.set({near:(0,i.su)(e)})}get far(){return this.get(e=>e.far)}set far(e){this.set({far:(0,i.su)(e)})}get resolution(){return this.get(e=>e.resolution)}set resolution(e){this.set({resolution:(0,i.su)(e)})}get background(){return this.get(e=>e.background)}set background(e){this.set({background:"only"===e?e:(0,i.Ig)(e)})}get map(){return this.get(e=>e.map)}set map(e){this.set({map:e})}get files(){return this.get(e=>e.files)}set files(e){this.set({files:e})}get path(){return this.get(e=>e.path)}set path(e){this.set({path:e})}get preset(){return this.get(e=>e.preset)}set preset(e){this.set({preset:e})}get scene(){return this.get(e=>e.scene)}set scene(e){this.set({scene:e})}get extensions(){return this.get(e=>e.extensions)}set extensions(e){this.set({extensions:e})}get ground(){return this.get(e=>e.ground)}set ground(e){this.set({ground:i.is.obj(e)?e:(0,i.Ig)(e)})}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275dir=o.lG2({type:n,inputs:{frames:"frames",near:"near",far:"far",resolution:"resolution",background:"background",map:"map",files:"files",path:"path",preset:"preset",scene:"scene",extensions:"extensions",ground:"ground"},features:[o.qOj]}),n})(),ce=(()=>{class n{constructor(e){this.host=e}set ngtSobaEnvironmentPassThrough(e){this.assertWrapper(e),e.select(e.select(t=>t.frames).pipe((0,i.Xb)()),e.select(t=>t.near).pipe((0,i.Xb)()),e.select(t=>t.far).pipe((0,i.Xb)()),e.select(t=>t.resolution).pipe((0,i.Xb)()),e.select(t=>t.background).pipe((0,i.Xb)()),e.select(t=>t.map).pipe((0,i.Xb)()),e.select(t=>t.files).pipe((0,i.Xb)()),e.select(t=>t.path).pipe((0,i.Xb)()),e.select(t=>t.preset).pipe((0,i.Xb)()),e.select(t=>t.scene).pipe((0,i.Xb)()),e.select(t=>t.extensions).pipe((0,i.Xb)()),e.select(t=>t.ground).pipe((0,i.Xb)())).pipe((0,m.R)(e.destroy$)).subscribe(()=>{this.host.frames=e.frames,this.host.near=e.near,this.host.far=e.far,this.host.resolution=e.resolution,this.host.background=e.background,this.host.map=e.map,this.host.files=e.files,this.host.path=e.path,this.host.preset=e.preset,this.host.scene=e.scene,this.host.extensions=e.extensions,this.host.ground=e.ground})}assertWrapper(e){if(!(e instanceof z))throw new Error("[ngtSobaEnvironmentPassThrough] wrapper is not an NgtSobaEnvironmentGeneric")}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(z,10))},n.\u0275dir=o.lG2({type:n,selectors:[["","ngtSobaEnvironmentPassThrough",""]],inputs:{ngtSobaEnvironmentPassThrough:"ngtSobaEnvironmentPassThrough"},standalone:!0}),n})(),te=(()=>{class n extends i.gU{constructor(e,t){super(),this.loader=e,this.store=t,this.setTexture=this.effect((0,i.oe)(()=>{const{textureRef:a,extensions:s,preset:c}=this.get();let{files:u,path:h}=this.get();if(c){if(!(c in ie))throw new Error("Preset must be one of: "+Object.keys(ie).join(", "));u=ie[c],h="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const y=Array.isArray(u),D=this.loader.use(y?l.cBK:Re,y?[u]:u,I=>{I.setPath(h),s&&s(I)}).subscribe(I=>{const L=y?I[0]:I;L.mapping=y?l.fY$:l.dSO,a.set(L)});return()=>{D.unsubscribe()}})),this.set({textureRef:new i.Rl})}use(e){this.useSubscription&&this.useSubscription.unsubscribe();const t=e({files:["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:""}),a=(0,B.b)(t)?t:(0,R.of)(t);return this.set(a),this.useSubscription=this.store.onReady(()=>(this.setTexture(this.select(this.select(s=>s.path),this.select(s=>s.files),this.select(s=>s.preset).pipe((0,i.Xb)()),this.select(s=>s.extensions).pipe((0,i.Xb)()))),()=>{this.useSubscription&&this.useSubscription.unsubscribe()})),this.get(s=>s.textureRef)}}return n.\u0275fac=function(e){return new(e||n)(o.LFG(i.gj),o.LFG(i.W7))},n.\u0275prov=o.Yz7({token:n,factory:n.\u0275fac}),n})(),ue=(()=>{class n extends z{constructor(){super(...arguments),this.setEnvironment=this.effect((0,i.oe)(()=>{const{map:e,background:t,scene:a}=this.get(),s=this.store.get(c=>c.scene);if(e){const c=se(a||s),u=c.background,h=c.environment;return"only"!==t&&(c.environment=e),t&&(c.background=e),()=>{"only"!==t&&(c.environment=h),t&&(c.background=u)}}}))}preInit(){super.preInit(),this.set(e=>({background:e.background??!1}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.store.onReady(()=>{this.setEnvironment(this.select(this.store.select(e=>e.scene),this.select(e=>e.background),this.select(e=>e.map),this.select(e=>e.scene).pipe((0,i.Xb)())))})})}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-environment-map","map",""]],standalone:!0,features:[o._Bn([{provide:z,useExisting:n}]),o.qOj,o.jDz],attrs:Ie,ngContentSelectors:ee,decls:1,vars:0,template:function(e,t){1&e&&(o.F$t(),o.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),be=(()=>{class n extends z{constructor(){super(...arguments),this.environmentResolver=(0,o.f3M)(te),this.setEnvironment=this.effect((0,i.oe)(({texture:e})=>{const t=this.store.get(y=>y.scene),{background:a,scene:s}=this.get(),c=se(s||t),u=c.background,h=c.environment;return"only"!==a&&(c.environment=e),a&&(c.background=e),()=>{"only"!==a&&(c.environment=h),a&&(c.background=u)}}))}preInit(){super.preInit(),this.set(e=>({background:e.background??!1}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.store.onReady(()=>{const e=this.environmentResolver.use(t=>this.select(this.select(a=>a.files).pipe((0,j.O)(t.files)),this.select(a=>a.path).pipe((0,j.O)(t.path)),this.select(a=>a.preset).pipe((0,i.Xb)()),this.select(a=>a.extensions).pipe((0,i.Xb)()),(a,s,c,u)=>({files:a,path:s,preset:c,extensions:u})));this.setEnvironment(this.select(e.pipe((0,A.h)(t=>!!t)),this.select(t=>t.background),this.select(t=>t.scene).pipe((0,i.Xb)()),this.store.select(t=>t.scene),t=>({texture:t})))})})}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-environment-cube"]],standalone:!0,features:[o._Bn([{provide:z,useExisting:n},te]),o.qOj,o.jDz],ngContentSelectors:ee,decls:1,vars:0,template:function(e,t){1&e&&(o.F$t(),o.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),le=(()=>{class n{constructor(e){this.templateRef=e}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.Rgc))},n.\u0275dir=o.lG2({type:n,selectors:[["ng-template","ngt-soba-environment-content",""]],standalone:!0}),n})(),lt=(()=>{class n extends z{constructor(){super(...arguments),this.virtualScene=new i.Rl((0,i.Pl)(new l.xsS,()=>this.store.get())),this.cubeCamera=new i.Rl,this.count=1,this.fbo$=this.select(e=>e.fbo),this.setEnvironment=this.effect((0,i.oe)(()=>{const{gl:e,scene:t}=this.store.get(),{frames:a,scene:s,background:c,fbo:u}=this.get();1===a&&this.cubeCamera.value.update(e,this.virtualScene.value);const h=se(s||t),y=h.background,x=h.environment;return"only"!==c&&(h.environment=u.texture),c&&(h.background=u.texture),()=>{"only"!==c&&(h.environment=x),c&&(h.background=y)}}))}preInit(){super.preInit(),this.set(e=>({near:e.near??1,far:e.far??1e3,resolution:e.resolution??256,frames:e.frames??1,background:e.background??!1}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.store.onReady(()=>{this.set(this.select(this.select(e=>e.resolution),e=>{const t=new l.oAp(e);return t.texture.type=l.cLu,{fbo:t}})),this.setEnvironment(this.select(this.select(),this.cubeCamera.pipe((0,A.h)(e=>!!e))))})})}onBeforeRender(){const{camera:e,frames:t}=this.get(),a=this.store.get(s=>s.gl);e&&(t===1/0||this.count<t)&&(e.update(a,this.virtualScene.value),this.count++)}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-environment-portal"]],contentQueries:function(e,t,a){if(1&e&&o.Suo(a,le,7),2&e){let s;o.iGM(s=o.CRH())&&(t.content=s.first)}},standalone:!0,features:[o._Bn([{provide:z,useExisting:n}]),o.qOj,o.jDz],decls:7,vars:7,consts:[[3,"ref"],[4,"ngTemplateOutlet"],[3,"ref","args","beforeRender",4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["environmentMap",""],[3,"ref","args","beforeRender"],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map"]],template:function(e,t){if(1&e&&(o.TgZ(0,"ngt-portal",0),o.YNc(1,ke,1,0,"ng-container",1),o.YNc(2,Oe,1,6,"ngt-cube-camera",2),o.ALo(3,"async"),o.YNc(4,je,1,1,"ngt-soba-environment-cube",3),o.YNc(5,Ae,1,2,"ng-template",null,4,o.W1O),o.qZA()),2&e){const a=o.MAs(6);o.Q6J("ref",t.virtualScene),o.xp6(1),o.Q6J("ngTemplateOutlet",t.content.templateRef),o.xp6(1),o.Q6J("ngIf",o.lcZ(3,5,t.fbo$)),o.xp6(2),o.Q6J("ngIf",t.files||t.preset)("ngIfElse",a)}},dependencies:[i.WS,pe.eR,ce,be,ue,O.O5,O.Ov],encapsulation:2,changeDetection:0}),n})(),gt=(()=>{class n extends z{constructor(){super(...arguments),this.materialRef=new i.Rl,this.vertexShader="\nvarying vec3 vWorldPosition;\n\nvoid main() {\n  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n  vWorldPosition = worldPosition.xyz;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",this.environmentResolver=(0,o.f3M)(te),this.uniforms={cubemap:{value:null},height:{value:15},radius:{value:60}},this.environmentGroundViewModel$=this.select(this.select(e=>e.texture),this.select(e=>e.scale),this.select(e=>e.fragment),(e,t,a)=>({texture:e,scale:t,fragment:a})),this.setDefines=this.effect((0,w.b)(()=>{const{isCubeMap:e,texture:t}=this.get(),c=Math.floor(Math.log2(((e?t.image[0]?.width:t.image.width)??1024)/4)),u=Math.pow(2,c),h=3*Math.max(u,112);this.set({defines:[e?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/h,"#define CUBEUV_TEXEL_HEIGHT "+1/(4*u),`#define CUBEUV_MAX_MIP ${c}.0`,""]})})),this.setFragment=this.effect((0,w.b)(()=>{const e=this.get(t=>t.defines);this.set({fragment:e.join("\n")+"\n#define ENVMAP_TYPE_CUBE_UV\n\nvarying vec3 vWorldPosition;\n\nuniform float radius;\nuniform float height;\n\n#ifdef ENVMAP_TYPE_CUBE\n  uniform samplerCube cubemap;\n#else\n  uniform sampler2D cubemap;\n#endif\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat diskIntersect( in vec3 ro, in vec3 rd, vec3 c, vec3 n, float r ) {\n    vec3  o = ro - c;\n    float t = -dot(n, o)/dot(rd,n);\n    vec3  q = o + rd * t;\n    return (dot(q, q) < r * r) ? t : 1e6;\n}\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat sphereIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra ) {\n    vec3 oc = ro - ce;\n    float b = dot( oc, rd );\n    float c = dot( oc, oc ) - ra*ra;\n    float h = b * b - c;\n    if(h < 0.0) -1.0;\n    h = sqrt( h );\n    return -b + h;\n}\n\nvec3 project() {\n  vec3 p = normalize(vWorldPosition);\n  vec3 camPos = cameraPosition;\n  camPos.y -= height;\n\n  float intersection = sphereIntersect(camPos, p, vec3(0.), radius);\n  if(intersection > 0.) {\n    vec3 h = vec3(0.0,-height,0.0);\n    float intersection2 = diskIntersect(camPos, p, h, vec3(0.0,-1.0,0.0), radius);\n    p = (camPos + min(intersection, intersection2) * p) / radius;\n  }\n  else {\n    p = vec3(0.0,1.0,0.0);\n  }\n  return p;\n}\n\n#include <common>\n#include <cube_uv_reflection_fragment>\n\nvoid main(){\n  vec3 projectedWorldPosition = project();\n\n  #ifdef ENVMAP_TYPE_CUBE\n    vec3 outcolor = textureCube(cubemap, projectedWorldPosition).rgb;\n  #else\n    vec3 direction = normalize(projectedWorldPosition);\n    vec2 uv = equirectUv(direction);\n    vec3 outcolor = texture2D(cubemap, uv).rgb;\n  #endif\n\n  gl_FragColor = vec4(outcolor, 1.0);\n\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n}"})})),this.setMaterialOptions=this.effect((0,w.b)(()=>{const e=this.get(t=>t.ground);this.set({height:e?.height,radius:e?.radius,scale:e?.scale??1e3})})),this.setHeightUniform=this.effect((0,q.z)((0,b.Q)(v.Z),(0,w.b)(()=>{const{height:e}=this.get();this.materialRef.value&&e&&(this.materialRef.value.uniforms.height.value=e)}))),this.setRadiusUniform=this.effect((0,q.z)((0,b.Q)(v.Z),(0,w.b)(()=>{const{radius:e}=this.get();this.materialRef.value&&e&&(this.materialRef.value.uniforms.radius.value=e)}))),this.setCubeMapUniform=this.effect((0,q.z)((0,b.Q)(v.Z),(0,w.b)(()=>{const{texture:e}=this.get();this.materialRef.value&&(this.materialRef.value.uniforms.cubemap.value=e)})))}ngOnInit(){super.ngOnInit(),this.store.onReady(()=>{const e=this.environmentResolver.use(t=>this.select(this.select(a=>a.files).pipe((0,j.O)(t.files)),this.select(a=>a.path).pipe((0,j.O)(t.path)),this.select(a=>a.preset).pipe((0,i.Xb)()),this.select(a=>a.extensions).pipe((0,i.Xb)()),(a,s,c,u)=>({files:a,path:s,preset:c,extensions:u})));this.set(this.select(this.select(t=>t.map).pipe((0,i.Xb)()),e.pipe((0,A.h)(t=>!!t)),(t,a)=>(t&&(a=t),{texture:a,isCubeMap:ut(a)}))),this.setDefines(this.select(t=>t.texture).pipe((0,g.q)(1))),this.setFragment(this.select(t=>t.defines)),this.setMaterialOptions(this.select(t=>t.ground)),this.setHeightUniform(this.select(this.materialRef.pipe((0,A.h)(t=>!!t)),this.select(t=>t.height).pipe((0,i.Xb)()))),this.setRadiusUniform(this.select(this.materialRef.pipe((0,A.h)(t=>!!t)),this.select(t=>t.radius).pipe((0,i.Xb)()))),this.setCubeMapUniform(this.select(this.materialRef.pipe((0,A.h)(t=>!!t)),this.select(t=>t.texture)))})}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-environment-ground"]],standalone:!0,features:[o._Bn([{provide:z,useExisting:n},te]),o.qOj,o.jDz],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough","map"],[3,"scale"],[3,"args"],[3,"ref","side","vertexShader","fragmentShader","uniforms"]],template:function(e,t){1&e&&(o.YNc(0,Ge,6,12,"ng-container",0),o.ALo(1,"async")),2&e&&o.Q6J("ngIf",o.lcZ(1,1,t.environmentGroundViewModel$))},dependencies:[ue,Z.oX,P.JH,me.yS,i.iv,ce,O.O5,O.Ov],encapsulation:2,changeDetection:0}),n})(),ye=(()=>{class n extends z{}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-environment"]],contentQueries:function(e,t,a){if(1&e&&o.Suo(a,le,5),2&e){let s;o.iGM(s=o.CRH())&&(t.content=s.first)}},standalone:!0,features:[o._Bn([{provide:z,useExisting:n}]),o.qOj,o.jDz],ngContentSelectors:ee,decls:4,vars:2,consts:[[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["mapOrPortalOrCube",""],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map",4,"ngIf","ngIfElse"],["portalOrCube",""],[3,"ngtSobaEnvironmentPassThrough","map"],["cube",""],["ngt-soba-environment-content",""],[4,"ngTemplateOutlet"]],template:function(e,t){if(1&e&&(o.F$t(),o.YNc(0,Ue,1,1,"ngt-soba-environment-ground",0),o.YNc(1,qe,3,2,"ng-template",null,1,o.W1O),o.Hsn(3)),2&e){const a=o.MAs(2);o.Q6J("ngIf",!!t.ground)("ngIfElse",a)}},dependencies:[gt,ue,lt,be,ce,le,O.O5,O.tP],encapsulation:2,changeDetection:0}),n})();function dt(n,r,e=new l.Pa4){const t=Math.PI*(n-.5),a=2*Math.PI*(r-.5);return e.x=Math.cos(a),e.y=Math.sin(t),e.z=Math.sin(a),e}let ht=(()=>{class n{constructor(e){this.templateRef=e}static ngTemplateContextGuard(e,t){return!0}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.Rgc))},n.\u0275dir=o.lG2({type:n,selectors:[["ng-template","ngt-soba-sky-content",""]],standalone:!0}),n})(),pt=(()=>{class n extends i.uT{constructor(){super(...arguments),this.setScale=this.effect((0,w.b)(()=>{const e=this.get(t=>t.distance);this.instance.value.scale.copy((new l.Pa4).setScalar(e))})),this.updateMaterialUniforms=this.effect((0,w.b)(()=>{const{mieCoefficient:e,mieDirectionalG:t,rayleigh:a,sunPosition:s,turbidity:c}=this.get(),u=this.instance.value.material;u.uniforms.mieCoefficient.value=e,u.uniforms.mieDirectionalG.value=t,u.uniforms.rayleigh.value=a,u.uniforms.sunPosition.value=s,u.uniforms.turbidity.value=c,(0,i.QF)(u)}))}set distance(e){this.set({distance:(0,i.su)(e)})}set sunPosition(e){this.set({sunPosition:e})}set inclination(e){this.set({inclination:(0,i.su)(e)})}set azimuth(e){this.set({azimuth:(0,i.su)(e)})}set mieCoefficient(e){this.set({mieCoefficient:(0,i.su)(e)})}set mieDirectionalG(e){this.set({mieDirectionalG:(0,i.su)(e)})}set rayleigh(e){this.set({rayleigh:(0,i.su)(e)})}set turbidity(e){this.set({turbidity:(0,i.su)(e)})}preInit(){super.preInit(),this.set(e=>{const t=e.inclination??.6,a=e.azimuth??.1;return{inclination:t,azimuth:a,distance:e.distance??1e3,mieCoefficient:e.mieCoefficient??.005,mieDirectionalG:e.mieDirectionalG??.8,rayleigh:e.rayleigh??.5,turbidity:e.turbidity??10,sunPosition:e.sunPosition??dt(t,a)}})}postInit(){super.postInit(),this.setScale(this.select(e=>e.distance)),this.updateMaterialUniforms(this.select(this.select(e=>e.mieCoefficient),this.select(e=>e.mieDirectionalG),this.select(e=>e.rayleigh),this.select(e=>e.sunPosition),this.select(e=>e.turbidity)))}get meshType(){return V}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-sky"]],contentQueries:function(e,t,a){if(1&e&&o.Suo(a,ht,5),2&e){let s;o.iGM(s=o.CRH())&&(t.content=s.first)}},inputs:{distance:"distance",sunPosition:"sunPosition",inclination:"inclination",azimuth:"azimuth",mieCoefficient:"mieCoefficient",mieDirectionalG:"mieDirectionalG",rayleigh:"rayleigh",turbidity:"turbidity"},standalone:!0,features:[o.qOj,o.jDz],ngContentSelectors:ee,decls:2,vars:1,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,t){1&e&&(o.F$t(),o.YNc(0,Je,1,4,"ng-container",0),o.Hsn(1)),2&e&&o.Q6J("ngIf",t.content)},dependencies:[O.O5,O.tP],encapsulation:2,changeDetection:0}),n})();new l.Pa4;const mt={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};let Se=(()=>{class n{constructor(e){this.templateRef=e}static ngTemplateContextGuard(e,t){return!0}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.Rgc))},n.\u0275dir=o.lG2({type:n,selectors:[["ng-template","ngt-soba-stage-content",""]],standalone:!0}),n})(),ft=(()=>{class n extends i.Kw{constructor(){super(...arguments),this.setDimensions=this.effect((0,q.z)((0,b.Q)(F.z),(0,w.b)(()=>{const{innerGroup:e,outerGroup:t}=this.get();if(e.value&&t.value){t.value.position.set(0,0,0),t.value.updateWorldMatrix(!0,!0);const a=(new l.ZzF).setFromObject(e.value),s=new l.Pa4,c=new l.aLr,u=a.max.y-a.min.y,h=a.max.x-a.min.x;a.getCenter(s),a.getBoundingSphere(c),this.zone.run(()=>{this.set({radius:c.radius,width:h,height:u})}),t.value.position.set(-s.x,u/2-s.y,-s.z)}}))),this.updateControls=this.effect((0,w.b)(()=>{const{adjustCamera:e,width:t,height:a,radius:s}=this.get(),{camera:c,controls:u}=this.store.get();if(e){const h=s/(a>t?1.5:2.5);c.position.set(0,.5*s,2.5*s),c.near=.1,c.far=Math.max(5e3,4*s),c.lookAt(0,h,0),u&&(u.target.set(0,h,0),u.update())}}))}get shadows(){return this.get(e=>e.shadows)}set shadows(e){this.set({shadows:(0,i.Ig)(e)})}get adjustCamera(){return this.get(e=>e.adjustCamera)}set adjustCamera(e){this.set({adjustCamera:(0,i.Ig)(e)})}get environment(){return this.get(e=>e.environment)}set environment(e){this.set({environment:e})}get intensity(){return this.get(e=>e.intensity)}set intensity(e){this.set({intensity:(0,i.su)(e)})}get ambience(){return this.get(e=>e.ambience)}set ambience(e){this.set({ambience:(0,i.su)(e)})}get preset(){return this.get(e=>e.preset)}set preset(e){this.set({preset:e})}get shadowBias(){return this.get(e=>e.shadowBias)}set shadowBias(e){this.set({shadowBias:(0,i.su)(e)})}get contactShadow(){return this.get(e=>e.contactShadow)}set contactShadow(e){this.set({contactShadow:e})}get innerGroup(){return this.get(e=>e.innerGroup)}get outerGroup(){return this.get(e=>e.outerGroup)}get radius(){return this.get(e=>e.radius)}get width(){return this.get(e=>e.width)}get height(){return this.get(e=>e.height)}get config(){return mt[this.get(e=>e.preset)]}preInit(){super.preInit(),this.set(e=>({innerGroup:new i.Rl,outerGroup:new i.Rl,radius:0,width:0,height:0,shadows:e.shadows??!0,adjustCamera:e.adjustCamera??!0,environment:e.environment??"city",intensity:e.intensity??1,preset:e.preset??"rembrandt",shadowBias:e.shadowBias??0,contactShadow:e.contactShadow??{blur:2,opacity:.5,position:[0,0,0]}}))}ngAfterContentInit(){this.zone.runOutsideAngular(()=>{this.store.onReady(()=>{this.setDimensions(this.select(this.innerGroup.pipe((0,A.h)(e=>!!e)),this.outerGroup.pipe((0,A.h)(e=>!!e)),this.children.changes.pipe((0,ne.w)(()=>(0,Ce.a)(this.children.map(e=>e())))))),this.updateControls(this.select(this.store.select(e=>e.controls),this.select(e=>e.radius).pipe(X(1)),this.select(e=>e.height).pipe(X(1)),this.select(e=>e.width).pipe(X(1)),this.select(e=>e.adjustCamera)))})})}}return n.\u0275fac=function(){let r;return function(t){return(r||(r=o.n5z(n)))(t||n)}}(),n.\u0275cmp=o.Xpm({type:n,selectors:[["ngt-soba-stage"]],contentQueries:function(e,t,a){if(1&e&&(o.Suo(a,Se,5),o.Suo(a,i.Dh,4)),2&e){let s;o.iGM(s=o.CRH())&&(t.content=s.first),o.iGM(s=o.CRH())&&(t.children=s)}},inputs:{shadows:"shadows",adjustCamera:"adjustCamera",environment:"environment",intensity:"intensity",ambience:"ambience",preset:"preset",shadowBias:"shadowBias",contactShadow:"contactShadow"},standalone:!0,features:[o._Bn([(0,i.RD)(n),(0,i.wY)(n,r=>r.innerGroup),(0,i.Hm)(n)]),o.qOj,o.jDz],decls:10,vars:23,consts:[["skipParent","",3,"ngtObjectPassThrough"],[3,"ref"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"scale","far","blur","opacity","position",4,"ngIf"],[3,"preset",4,"ngIf"],[3,"intensity"],["penumbra","1",3,"position","intensity","castShadow"],[3,"attach","value"],[3,"position","intensity"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"scale","far","blur","opacity","position"],[3,"preset"]],template:function(e,t){1&e&&(o.TgZ(0,"ngt-group",0)(1,"ngt-group",1)(2,"ngt-group",1),o.YNc(3,Xe,1,4,"ng-container",2),o.qZA()(),o.YNc(4,$e,1,5,"ngt-soba-contact-shadows",3),o.YNc(5,Ke,1,1,"ngt-soba-environment",4),o._UZ(6,"ngt-ambient-light",5),o.TgZ(7,"ngt-spot-light",6),o._UZ(8,"ngt-value",7),o.qZA(),o._UZ(9,"ngt-point-light",8),o.qZA()),2&e&&(o.Q6J("ngtObjectPassThrough",t),o.xp6(1),o.Q6J("ref",t.outerGroup),o.xp6(1),o.Q6J("ref",t.innerGroup),o.xp6(1),o.Q6J("ngIf",t.content),o.xp6(1),o.Q6J("ngIf",t.contactShadow),o.xp6(1),o.Q6J("ngIf",t.environment),o.xp6(1),o.Q6J("intensity",t.intensity/3),o.xp6(1),o.Q6J("position",o.kEZ(14,ae,t.config.main[0]*t.radius,t.config.main[1]*t.radius,t.config.main[2]*t.radius))("intensity",2*t.intensity)("castShadow",t.shadows),o.xp6(1),o.Q6J("attach",o.DdM(18,et))("value",t.shadowBias),o.xp6(1),o.Q6J("position",o.kEZ(19,ae,t.config.fill[0]*t.radius,t.config.fill[1]*t.radius,t.config.fill[2]*t.radius))("intensity",t.intensity))},dependencies:[U.U,i.VL,at,ye,oe.wx,oe.KN,oe.HY,Fe.mI,O.O5,O.tP],encapsulation:2,changeDetection:0}),n})()}}]);